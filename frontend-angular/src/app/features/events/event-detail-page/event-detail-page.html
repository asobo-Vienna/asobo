<!-- First Row for Image -->
<div class="row text-start">
  <!-- Image column -->
  <div class="col-md-6 event-image-container">
    <img
      class="card-img-top"
      [src]="UrlUtilService.getMediaUrl(pictureURI || environment.eventDummyCoverPicRelativeUrl)"
      alt="{{ title }}"
    />
    @if (authService.isLoggedIn()) {
      <p-tag
        class="event-badge"
        [icon]="this.isPrivate ? 'pi pi-lock' : 'pi pi-globe'"
        [severity]="this.isPrivate ? 'warn' : 'success'"
        [value]="this.isPrivate ? 'Private' : 'Public'"
      />
    }
  </div>

  <!-- TODO refactor to component when done -->
  <!-- Event Info Column -->
  <div class="col-md-6 text-start">
    <form [formGroup]="editEventForm" (ngSubmit)="onSubmit()" [class.editing]="isEditing">
    <div class="mb-3">
      <div class="row">
        <div class="col" id="event-basic-info-container">
          <div class="d-flex justify-content-between">
            <textarea
              type="text"
              id="event-title"
              class="event-title-textarea fw-bold"
              formControlName="title"
              pInputText
              [readonly]="!isEditing"
              cdkTextareaAutosize
              cdkAutosizeMinRows="1"
              cdkAutosizeMaxRows="10"
            ></textarea>

            @if (isEditing) {
              <p-datepicker
                formControlName="date"
                name="date"
                [showIcon]="true"
                dateFormat="dd MM yy at"
                [showTime]="true"
                hourFormat="12"
                [readonlyInput]="!isEditing"
              >
              </p-datepicker>
            }

            <div id="event-date" class="date-font-color ms-1 flex-shrink-0">
              {{ date | date : 'EEE, MMMM d, y' }}
              <div id="event-time" class="date-font-color ms-1 small event-time">
                {{ time | date : 'h:mm a' }}
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between">
            <input
              type="text"
              id="event-location"
              class="date-font-color small flex-grow-1"
              formControlName="location"
              pInputText
              [readonly]="!isEditing"
            />
          </div>
        </div>
        <div class="col-md-4">
          @if (authService.isLoggedIn() && !isEditing) {
            @if (isUserAlreadyPartOfEvent()) {
              <a class="btn btn-purple imin-btn" (click)="joinOrLeaveEvent()">I'm out!</a>
            } @else {
              <a class="btn btn-purple imin-btn" (click)="joinOrLeaveEvent()">I'm in!</a>
            }
          }
        </div>
        <div class="col-md-8"><!-- spacer --></div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-8">
        <div id="event-description-container" class="mb-3 p-3 infobox">
          <textarea
            formControlName="description"
            rows="5"
            class="event-description-textarea"
            [readonly]="!isEditing"
          ></textarea>
        </div>

        @if (authService.hasAdminAccess() || isCurrentUserEventAdmin(event(), currentUser)) {
          <div class="d-flex justify-content-end">
            <i class="pi pi-pen-to-square" (click)="toggleEdit()" style="cursor: pointer;"></i>
          </div>
        }

        @if (isEditing) {
          <div class="form-group d-flex justify-content-center">
            <button class="btn btn-purple btn-primary mt-4 me-2" id="create-event-button" type="submit">
              Update
            </button>
            <button class="btn btn-secondary mt-4" id="create-event-button" type="button" (click)="toggleEdit()">
              Cancel
            </button>
          </div>
        }

        </div>
      </div>
      <div class="col-md-4"><!-- spacer --></div>
    </form>
    </div>
  </div>


@if (this.authService.isLoggedIn()) {
  <div class="row text-start mt-4 align-items-center gx-5">
    <!-- Comment Box for new comment -->
    <div class="col-md-6">
      <app-new-comment
        [author]="currentUser"
        (commentCreated)="onCommentCreated($event)"
      ></app-new-comment>
    </div>

    <!-- Participants -->
    <div class="col-md-6 text-start">
      <app-participants [participants]="participants()"/>
    </div>
  </div>

  <!-- Existing comments list -->
  <div class="row text-start mt-3 gx-5">
    <div class="col-md-6 text-start">
      <app-comments-list
        [comments]="comments()"
        (commentDeleted)="deleteComment($event)"
        (commentEdited)="editComment($event)"
      />
    </div>

    <!-- Photos & Video -->
    <div class="col-md-6 mt-3 text-start">
      <app-gallery
        [mediaItems]="mediaItems()"
        (mediaAdded)="uploadMedia($event)"
        (mediaDeleted)="deleteMedia($event)"
      />
    </div>
  </div>
}
